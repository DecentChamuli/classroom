import { NextRequest, NextResponse } from 'next/server'
// import { verify } from 'jsonwebtoken'
import jwt from 'jsonwebtoken'

// const secret = process.env.TOKEN_SECRET

export default async function middleware(req:NextRequest) {
    const { cookies } = req
    const token = cookies.authToken
    const url = req.url

    // if(url.includes('/getusers')){
    if(url.includes('/getusers')){
        if(token === undefined){ 
            const url = req.nextUrl.clone()
            url.pathname = '/'
            return NextResponse.redirect(url)
            // return console.log('token undefined')   
        }
        try {
            // const user = jwt.verify(token, "14454sad")
            // return console.log('token defined')   
            // return console.log(user)   
            // return NextResponse.next()
        } catch (e) {
            console.log(e)
            // return NextResponse.redirect('/login')
        }
    }
    // return console.log('last')   
    return NextResponse.next()
}